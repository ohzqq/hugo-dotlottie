{{$params := slice}}
{{ with .Get "AspectRatio" }}
  {{$val := printf "AspectRatio=%s" (urlquery . | safeURL)}}
  {{$params = $params | append $val }}
{{ end }}
{{$src := ""}}
{{$page := .Page}}
{{with .Page.Resources.GetMatch "*.lottie"}}
  {{$src = urls.JoinPath $page.RelPermalink .}}
  {{$src = printf "Src=%s" (urlquery $src | safeURL)}}
{{else with .Get "Src" }}
  {{$src = printf "Src=%s" (urlquery . | safeURL)}}
{{ end }}
  {{$params = $params | append $src }}
{{ with .Get "Mode" }}
  {{$val := printf "Mode=%s" (urlquery . | safeURL)}}
  {{$params = $params | append $val }}
{{ end }}
{{ with .Get "Speed" }}
  {{$val := printf "Speed=%s" (urlquery . | safeURL)}}
  {{$params = $params | append $val }}
{{ end }}
{{ with .Get "BgColor" }}
  {{$val := printf "BgColor=%s" (urlquery . | safeURL)}}
  {{$params = $params | append $val }}
{{ end }}
{{ with .Get "BgImg" }}
  {{$val := printf "BgImg=%s" (urlquery . | safeURL)}}
  {{$params = $params | append $val }}
{{ end }}
{{ with .Get "Loop" }}
  {{$params = $params | append "Loop=true" }}
{{ end }}
{{ with .Get "NoControls" }}
  {{$params = $params | append "NoControls=true" }}
{{ end }}
{{ with .Get "Autoplay" }}
  {{$params = $params | append "Autoplay=true" }}
{{end}}
  {{$q := delimit $params "&"}}
  {{$p := urls.JoinPath site.BaseURL "gottie" "player.html"}}
  {{$iframe := printf "%s?%s" $p $q}}

<div class="dotlottie-container" 
     style="position: relative; overflow: hidden;
            {{with .Get "AspectRatio"}}aspect-ratio: {{. | safeCSS}};{{end}} width: 100%; display: block; outline: none;"> 
<iframe class="player-frame" 
        allowfullscreen
        style="border: none; position: absolute; width: 100%; height: 100%; top: 0; left: 0; bottom: 0; right: 0;" 
        name="player-frame" 
        src="{{$iframe}}"> 
</iframe>
</div>

<script> 
const frame = document.querySelector('.player-frame')
function sendMsgToDotLottie(data) {
  frame.contentWindow?.postMessage(data, '*')
}
function onMsg(e) {
  console.log('msg', e.data)
}
window.addEventListener('message', onMsg)
</script>

