{{$params := slice}}
{{$iframe := ""}}
{{$src := ""}}
{{$page := .Page}}
{{$query := newScratch}}

{{with .Page.Resources.GetMatch "*.lottie"}}
  {{$src = urls.JoinPath $page.RelPermalink .}}
{{else with .Get "Src" }}
  {{$src = .}}
{{ end }}

{{ $query.SetInMap "q" "Src" $src }}

{{with $page.Params.cfg }}
  {{$url := urls.Parse (printf "https://example.com?" . )}}
  {{ with $url.Query.Get "AspectRatio" }}
    {{ $query.SetInMap "q" "AspectRatio" . }}
  {{ end }}
  {{ with $url.Query.Get "Mode" }}
    {{ $query.SetInMap "q" "Mode" . }}
  {{ end }}
  {{ with $url.Query.Get "Speed" }}
    {{ $query.SetInMap "q" "Speed" . }}
  {{ end }}
  {{ with $url.Query.Get "Bgcolor" }}
    {{ $query.SetInMap "q" "Bgcolor" . }}
  {{ end }}
  {{ with $url.Query.Get "BgImg" }}
    {{ $query.SetInMap "q" "BgImg" . }}
  {{ end }}
  {{ with $url.Query.Get "Loop" }}
    {{ $query.SetInMap "q" "Loop" . }}
  {{ end }}
  {{ with $url.Query.Get "NoControls" }}
    {{ $query.SetInMap "q" "NoControls" . }}
  {{ end }}
  {{ with $url.Query.Get "Autoplay" }}
    {{ $query.SetInMap "q" "Autoplay" . }}
  {{ end }}
{{end}}

{{ with .Get "AspectRatio" }}
  {{ $query.SetInMap "q" "AspectRatio" . }}
{{ end }}
{{ with .Get "Mode" }}
    {{ $query.SetInMap "q" "Mode" . }}
{{ end }}
{{ with .Get "Speed" }}
    {{ $query.SetInMap "q" "Speed" . }}
{{ end }}
{{ with .Get "BgColor" }}
    {{ $query.SetInMap "q" "Bgcolor" . }}
{{ end }}
{{ with .Get "BgImg" }}
    {{ $query.SetInMap "q" "BgImg" . }}
{{ end }}
{{ with .Get "Loop" }}
    {{ $query.SetInMap "q" "Loop" . }}
{{ end }}
{{ with .Get "NoControls" }}
    {{ $query.SetInMap "q" "NoControls" . }}
{{ end }}
{{ with .Get "Autoplay" }}
    {{ $query.SetInMap "q" "Autoplay" . }}
{{end}}
  {{$q := collections.Querify ($query.Get "q")}}
  {{$p := urls.JoinPath site.BaseURL "gottie" "player.html"}}
  {{$iframe = printf "%s?%s" $p $q}}

<div class="dotlottie-container" 
     style="position: relative; overflow: hidden;
            {{with .Get "AspectRatio"}}aspect-ratio: {{. | safeCSS}};{{end}} width: 100%; display: block; outline: none;"> 
<iframe class="player-frame" 
        allowfullscreen
        style="border: none; position: absolute; width: 100%; height: 100%; top: 0; left: 0; bottom: 0; right: 0;" 
        name="player-frame" 
        src="{{$iframe}}"> 
</iframe>
</div>

<script> 
const frame = document.querySelector('.player-frame')
function sendMsgToDotLottie(data) {
  frame.contentWindow?.postMessage(data, '*')
}
function onMsg(e) {
  console.log('msg', e.data)
}
window.addEventListener('message', onMsg)
</script>

